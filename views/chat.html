<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chat - EcoConnect</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
    <header>
    <nav class="navbar">
      <div class="navbar-logo">
        <img src="/uploads/icon1contoh.png" alt="Logo" />
        <span>EcoConnect</span>
      </div>
      <ul class="navbar-links" id="navbarLinks">
        <li><a href="/explore">Daftar Proyek</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="/form-pengajuan">Pengajuan Proyek</a></li>
        <li><a href="/map">Peta Proyek</a></li>
        <li><a href="/leaderboard">Peringkat</a></li>
        <li><a href="/forum">Forum</a></li>
        <li><a href="/chat">Chat Admin</a></li>
        <li><a href="/withdraw">Pencairan</a></li>
        <li><a href="/profile">Profil</a></li>
        <li><a href="/auth/logout">Logout</a></li>
      </ul>
    </nav>
  </header>
  <div id="chat-container">
    <h2>Chat dengan Admin</h2>
    <div id="chat-messages"></div>
    <form id="chat-form" enctype="multipart/form-data">
      <input type="text" name="content" id="contentInput" placeholder="Tulis pesan..." required />
      <input type="file" name="image" id="imageInput" />
      <button type="submit">Kirim</button>
    </form>
  </div>
  <footer class="footer">
    <p>&copy; 2025 EcoConnect. All rights reserved.</p>
  </footer>
  <script>
    function loadChats() {
      fetch('/chat/my')
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById('chat-messages');
          box.innerHTML = '';
          data.forEach(chat => {
            const div = document.createElement('div');
            div.className = 'bubble ' + (chat.sender_id === 1 ? 'left' : 'right');
            div.innerHTML = `
              ${chat.content || ''}
              ${chat.image_url ? '<br><img src="${chat.image_url}" width="100"/>' : ''}
            `;
            box.appendChild(div);
          });
          box.scrollTop = box.scrollHeight;
        });
    }

    document.getElementById('chat-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      fetch('/chat/send', { method: 'POST', body: formData })
        .then(() => {
          this.reset();
          loadChats();
        });
    });

    loadChats();
    setInterval(loadChats, 5000);
  </script>
</body>
</html>
